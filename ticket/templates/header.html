{% if request.session.user %}
<!-- ===============================
     DESKTOP SIDEBAR
================================ -->
<aside class="sidebar d-none d-lg-flex flex-column">

  <!-- Brand -->
  <div class="sidebar-header">
    <div class="brand">
      <i class="fas fa-ticket-alt"></i>
      <span class="brand-text">TICKETS</span>
    </div>

    <button
      id="desktop-sidebar-toggle"
      class="sidebar-collapse-btn"
      title="ย่อ / ขยายเมนู"
    >
      <i class="fas fa-bars"></i>
    </button>
  </div>

  <!-- Menu -->
  <ul class="sidebar-menu list-unstyled flex-grow-1">

    <!-- ================= ADMIN / MANAGER ================= -->
    {% if request.session.user.role != "user" %}
    <li class="{% if request.path == '/' %}active{% endif %}">
      <a href="{% url 'dashboard' %}">
        <i class="fas fa-gauge-high"></i>
        <span>Dashboard</span>
      </a>
    </li>
    {% endif %}
    <li class="{% if request.path == '/tickets/' %}active{% endif %}">
      <a href="{% url 'tickets_list' %}">
        <i class="fas fa-ticket"></i>
        <span>Tickets</span>
      </a>
    </li>
    {% if request.session.user.role != "user" %}
    <li class="{% if request.path == '/' %}active{% endif %}">
      <a href="{% url 'setting_team' %}">
        <i class="fas fa-gauge-high"></i>
        <span>Setting</span>
      </a>
    </li>
    {% endif %}
    

    <!-- ================= USER + ADMIN ================= -->
    <li class="{% if request.path == '/create/' %}active{% endif %}">
      <a href="{% url 'create' %}">
        <i class="fas fa-file-circle-plus"></i>
        <span>Create Ticket</span>
      </a>
    </li>

    <!-- USER HISTORY -->
    {% comment %} {% if request.session.user.role == "user" %}
    <li class="{% if request.path == '/my-tickets/' %}active{% endif %}">
      <a href="{% url 'my_tickets' %}">
        <i class="fas fa-list"></i>
        <span>My Tickets</span>
      </a>
    </li>
    {% endif %} {% endcomment %}
      <!-- Logout -->
    <div class="sidebar-footer">
      <a href="{% url 'logout' %}" class="logout-btn">
        <i class="fas fa-right-from-bracket"></i>
        <span>Logout</span>
      </a>
    </div>
  </ul>
</aside>
{% endif %}



<!-- ===============================
     MOBILE HEADER
================================ -->
<header class="mobile-header d-lg-none">
  <button id="mobile-sidebar-toggle" class="mobile-toggle">
    <i class="fas fa-bars"></i>
  </button>
  <span class="mobile-title">
    <i class="fas fa-ticket-alt me-2"></i>TICKETS
  </span>
</header>

<!-- ===============================
     MOBILE SIDEBAR
================================ -->
<aside id="mobile-sidebar" class="sidebar mobile-sidebar d-lg-none">
  <ul class="sidebar-menu list-unstyled">
    <li><a href="/"><i class="fas fa-gauge-high"></i> Dashboard</a></li>
    <li><a href="/tickets/"><i class="fas fa-ticket"></i> Tickets</a></li>
    <li><a href="/create/"><i class="fas fa-file-circle-plus"></i> Create Ticket</a></li>
    <li class="mt-4"><a href="/logout/"><i class="fas fa-right-from-bracket"></i> Logout</a></li>
  </ul>
</aside>

<div id="sidebar-overlay"></div>

<!-- ===============================
     CSS
================================ -->
<style>
/* ===== Layout ===== */
.sidebar {
  width: 260px;
  background: #0f172a;
  color: #e5e7eb;
  padding: 16px;
  transition: width .25s ease;
}

.sidebar.collapsed {
  width: 72px;
}

/* ===== Header ===== */
.sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
}

.brand-text {
  transition: opacity .2s ease;
}

.sidebar.collapsed .brand-text {
  opacity: 0;
  width: 0;
  overflow: hidden;
}

/* ===== Toggle Button ===== */
.sidebar-collapse-btn {
  background: rgba(255,255,255,.08);
  border: none;
  color: #fff;
  width: 36px;
  height: 36px;
  border-radius: 8px;
}

.sidebar-collapse-btn:hover {
  background: rgba(255,255,255,.18);
}

/* ===== Menu ===== */
.sidebar-menu li a {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: 10px;
  color: #cbd5e1;
  text-decoration: none;
}

.sidebar-menu li.active a,
.sidebar-menu li a:hover {
  background: rgba(255,255,255,.1);
  color: #fff;
}

.sidebar-menu li a span {
  transition: opacity .2s ease;
}

.sidebar.collapsed .sidebar-menu li a {
  justify-content: center;
}

.sidebar.collapsed .sidebar-menu li a span {
  display: none;
}

.sidebar.collapsed .sidebar-menu li a i {
  font-size: 1.25rem;
}

/* ===== Footer ===== */
.sidebar-footer a {
  display: flex;
  align-items: center;
  gap: 12px;
  color: #f87171;
  padding: 12px;
  border-radius: 10px;
}

/* ===== Mobile ===== */
.mobile-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 56px;
  background: #0f172a;
  display: flex;
  align-items: center;
  padding: 0 16px;
  z-index: 1200;
  color: #fff;
}

.mobile-toggle {
  background: none;
  border: none;
  color: #fff;
  font-size: 1.2rem;
}

.mobile-sidebar {
  position: fixed;
  top: 0;
  left: -260px;
  height: 100%;
  z-index: 1300;
  transition: left .3s ease;
}

.mobile-sidebar.show {
  left: 0;
}

#sidebar-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.4);
  display: none;
  z-index: 1200;
}
/* ===== Sidebar Footer (Logout) ===== */
.sidebar-footer {
  margin-top: auto;
  padding-top: 16px;
  border-top: 1px solid rgba(255,255,255,.08);
}

.logout-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: 10px;
  color: #fca5a5; /* แดงสุภาพ */
  text-decoration: none;
  transition: background .2s ease, color .2s ease;
}

.logout-btn:hover {
  background: rgba(239,68,68,.15);
  color: #fecaca;
}

/* ตอน sidebar พับ */
.sidebar.collapsed .logout-btn {
  justify-content: center;
}

.sidebar.collapsed .logout-btn span {
  display: none;
}

.sidebar.collapsed .logout-btn i {
  font-size: 1.25rem;
}

</style>

<!-- ===============================
     JS
================================ -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  /* ===== Desktop collapse ===== */
  const sidebar = document.querySelector(".sidebar.d-lg-flex");
  const desktopToggle = document.getElementById("desktop-sidebar-toggle");

  if (sidebar && desktopToggle) {
    if (localStorage.getItem("sidebar_collapsed") === "true") {
      sidebar.classList.add("collapsed");
    }

    desktopToggle.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
      localStorage.setItem(
        "sidebar_collapsed",
        sidebar.classList.contains("collapsed")
      );
    });
  }

  /* ===== Mobile sidebar ===== */
  const mobileSidebar = document.getElementById("mobile-sidebar");
  const mobileToggle = document.getElementById("mobile-sidebar-toggle");
  const overlay = document.getElementById("sidebar-overlay");

  if (mobileToggle) {
    mobileToggle.addEventListener("click", () => {
      mobileSidebar.classList.add("show");
      overlay.style.display = "block";
    });
  }

  overlay.addEventListener("click", closeMobile);

  function closeMobile() {
    mobileSidebar.classList.remove("show");
    overlay.style.display = "none";
  }
});
</script>
