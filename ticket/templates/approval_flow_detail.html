{% extends "base.html" %}
{% block title %}Approval Flow Detail{% endblock %}

{% block content %}
<div class="container-fluid approval-page">

  <!-- ================= HEADER ================= -->
  <div class="mb-4">
    <h4 class="fw-bold mb-1">
      <i class="bi bi-diagram-3 me-1 text-primary"></i>
      สายอนุมัติ
    </h4>
    <div class="text-muted">
      {{ category_name }} • {{ team_name }}
    </div>
  </div>

  <!-- ================= FLOW GRAPHIC ================= -->
  {% regroup flows by flow_no as flow_groups %}

  <div class="workflow-wrapper">

    {% for flow in flow_groups %}
    <div class="flow-card">

      <!-- Flow header -->
      <div class="flow-header">
        <span class="flow-pill">
          <i class="bi bi-layers me-1"></i>
          Flow {{ flow.grouper }}
        </span>
      </div>

      <!-- Steps -->
      <div class="flow-steps">
        {% for step in flow.list %}
        <div class="step-wrapper">

          <div class="step-card">
            <div class="step-level">
              Level {{ step.level }}
            </div>
            <div class="step-user">
              <i class="bi bi-person-check me-1 text-success"></i>
              {{ step.full_name }}
            </div>
          </div>

          {% if not forloop.last %}
          <div class="step-arrow">
            <span></span>
          </div>
          {% endif %}

        </div>
        {% endfor %}
      </div>

    </div>
    {% endfor %}

  </div>

  <a href="{% url 'add_approve_line' %}"
     class="btn btn-outline-secondary mt-4">
    ← กลับหน้ารวม
  </a>

</div>

<!-- ================= STYLE ================= -->
<style>
/* ===== Wrapper ===== */
.workflow-wrapper {
  display: flex;
  flex-direction: column;
  gap: 32px;
}

/* ===== Flow Card ===== */
.flow-card {
  background: #ffffff;
  border-radius: 20px;
  padding: 20px 22px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 10px 30px rgba(0,0,0,.05);
}

/* Flow header */
.flow-header {
  margin-bottom: 16px;
}

.flow-pill {
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  color: #fff;
  font-weight: 700;
  font-size: .85rem;
  padding: 8px 18px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
}

/* ===== Steps ===== */
.flow-steps {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 14px;
}

.step-wrapper {
  display: flex;
  align-items: center;
}

/* ===== Step Card ===== */
.step-card {
  min-width: 180px;
  background: #ffffff;
  border-radius: 16px;
  padding: 14px 16px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 6px 16px rgba(0,0,0,.06);
  transition: transform .2s ease, box-shadow .2s ease;
}

.step-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 26px rgba(0,0,0,.12);
}

.step-level {
  font-size: .75rem;
  font-weight: 700;
  color: #2563eb;
  margin-bottom: 6px;
}

.step-user {
  font-size: .9rem;
  font-weight: 600;
  color: #111827;
}

/* ===== Arrow ===== */
.step-arrow {
  width: 28px;
  height: 2px;
  background: #c7d2fe;
  position: relative;
  margin: 0 10px;
}

.step-arrow span {
  position: absolute;
  right: -6px;
  top: -4px;
  width: 10px;
  height: 10px;
  border-top: 2px solid #c7d2fe;
  border-right: 2px solid #c7d2fe;
  transform: rotate(45deg);
}

/* ===== Mobile ===== */
@media (max-width: 768px) {
  .flow-steps {
    flex-direction: column;
    align-items: flex-start;
  }

  .step-arrow {
    transform: rotate(90deg);
    margin: 12px 0;
  }
}
</style>
{% endblock %}
