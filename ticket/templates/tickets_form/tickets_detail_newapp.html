{% extends "base.html" %}
{% load tz %}
{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠ New App{% endblock %}

{% block content %}
<main class="main-content">

    <div class="dashboard-card">

        <h3 class="fw-bold mb-3">{{ ticket.title }}</h3>

        <div class="mb-2">
            <strong>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</strong> {{ ticket.user_name }}
        </div>

        <div class="mb-2">
            <strong>‡πÅ‡∏ú‡∏ô‡∏Å:</strong> {{ ticket.department }}
        </div>

        <div class="mb-2">
            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á:</strong>
            {{ ticket.create_at|localtime|date:"d M Y H:i" }} ‡∏ô.
        </div>

        <hr>

        <div class="mb-3">
            <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠</strong>
            <p class="mt-1">{{ ticket.description }}</p>
        </div>
        <div class="mb-3">
            <strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</strong>
            <p class="mt-1">{{ detail.new_value }}</p>
        </div>

        {# ================= APPROVE SECTION ================= #}
        {% if can_approve or is_admin %}
        <div class="card shadow-sm border-success mb-4">
            <div class="card-body">

                {# ---------- INFO ---------- #}
                {% if is_admin %}
                <div class="fw-semibold text-danger mb-2">
                    ‚ö† ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin
                </div>
                {% else %}
                <div class="fw-semibold text-success mb-2">
                    ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ (Level {{ my_level }})
                </div>
                {% endif %}

                {# ---------- APPROVE ‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢ ---------- #}
                {% if can_approve %}
                <form method="post" action="{% url 'approve_ticket' ticket.id %}" class="mb-2">
                    {% csrf_token %}
                    <textarea name="remark" class="form-control mb-2" rows="2"
                        placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    <button type="submit" class="btn btn-success">
                        ‚úÖ Approve
                    </button>
                </form>
                {% endif %}

                {# ---------- ADMIN ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô ---------- #}
                {% if is_admin and ticket.status_id != 4 and ticket.status_id != 5 %}
                <form method="post" action="{% url 'approve_ticket' ticket.id %}" class="mb-2">
                    {% csrf_token %}
                    <input type="hidden" name="admin_override" value="1">
                    <button type="submit" class="btn btn-danger">
                        üöÄ Admin ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
                    </button>
                </form>
                {% endif %}

                {# ---------- ADMIN ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏á‡∏≤‡∏ô ---------- #}
                {% if is_admin and ticket.status_id == 4 %}
                <form method="post" action="{% url 'admin_complete_ticket' ticket.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                    </button>
                </form>
                {% endif %}

            </div>
        </div>
        {% endif %}
        {%endblock %}