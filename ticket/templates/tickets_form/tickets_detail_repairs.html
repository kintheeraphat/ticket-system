{% extends "base.html" %}
{% load tz %}

{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£{% endblock %}

{% block content %}
<main class="main-content">

    <div class="container mt-4">

        <h3 class="fw-bold mb-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</h3>

        <div class="card shadow-sm mb-4">
            <div class="card-body">

                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠</strong><br>
                        #{{ detail.id }}
                    </div>
                    <div class="col-md-6">
                        <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</strong><br>
                        {{ detail.created_at|localtime|date:"d M Y H:i" }} ‡∏ô.
                    </div>
                </div>

                <hr>

                <div class="mb-3">
                    <strong>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</strong><br>
                    {{ detail.full_name }}
                </div>

                <div class="mb-3">
                    <strong>‡πÅ‡∏ú‡∏ô‡∏Å</strong><br>
                    {{ detail.department }}
                </div>

                <div class="mb-3">
                    <strong>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</strong><br>
                    {{ detail.building }}
                </div>

                <div class="mb-3">
                    <strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</strong><br>
                    {{ detail.title }}
                </div>

                <div class="mb-3">
                    <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</strong>
                    <div class="border rounded p-3 bg-light mt-1">
                        {{ detail.problem_detail|linebreaksbr }}
                    </div>
                </div>
            </div>
        </div>
        {% if can_approve or is_admin %}
        <div class="card shadow-sm border-success mb-4">
            <div class="card-body">

                {% if is_admin %}
                <div class="fw-semibold text-danger mb-2">
                    ‚ö† Admin Override Approval
                </div>
                {% else %}
                <div class="fw-semibold text-success mb-2">
                    ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Level {{ my_level }})
                </div>
                {% endif %}

                <form method="post" action="{% url 'approve_ticket' ticket.id %}">
                    {% csrf_token %}

                    <div class="mb-3">
                        <textarea name="remark" class="form-control" rows="2" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>

                    {% if is_admin %}
                    <input type="hidden" name="admin_override" value="1">
                    {% endif %}

                    <button type="submit" class="btn {% if is_admin %}btn-danger{% else %}btn-success{% endif %}">
                        {% if is_admin %}
                        üöÄ Admin Approve
                        {% else %}
                        ‚úÖ Approve
                        {% endif %}
                    </button>
                </form>

            </div>
        </div>
        {% endif %}
        <a href="/tickets" class="btn btn-secondary">
            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </a>
    </div>

</main>
{% endblock %}