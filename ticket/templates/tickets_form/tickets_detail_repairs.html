{% extends "base.html" %}
{% load tz %}

{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£{% endblock %}

{% block content %}
<main class="main-content">

    <div class="container mt-4">

        <h3 class="fw-bold mb-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</h3>

        <div class="card shadow-sm mb-4">
            <div class="card-body">

                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠</strong><br>
                        #{{ detail.id }}
                    </div>
                    <div class="col-md-6">
                        <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</strong><br>
                        {{ detail.created_at|localtime|date:"d M Y H:i" }} ‡∏ô.
                    </div>
                </div>

                <hr>

                <div class="mb-3">
                    <strong>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</strong><br>
                    {{ detail.full_name }}
                </div>

                <div class="mb-3">
                    <strong>‡πÅ‡∏ú‡∏ô‡∏Å</strong><br>
                    {{ detail.department }}
                </div>

                <div class="mb-3">
                    <strong>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</strong><br>
                    {{ detail.building }}
                </div>

                <div class="mb-3">
                    <strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</strong><br>
                    {{ detail.title }}
                </div>

                <div class="mb-3">
                    <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</strong>
                    <div class="border rounded p-3 bg-light mt-1">
                        {{ detail.problem_detail|linebreaksbr }}
                    </div>
                </div>
            </div>
        </div>
        {# ================= APPROVE SECTION ================= #}
        {% if can_approve or is_admin %}
        <div class="card shadow-sm border-success mb-4">
            <div class="card-body">

                {# ---------- INFO ---------- #}
                {% if is_admin %}
                <div class="fw-semibold text-danger mb-2">
                    ‚ö† ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin
                </div>
                {% else %}
                <div class="fw-semibold text-success mb-2">
                    ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ (Level {{ my_level }})
                </div>
                {% endif %}

                {# ---------- APPROVE ‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢ ---------- #}
                {% if can_approve %}
                <form method="post" action="{% url 'approve_ticket' ticket.id %}" class="mb-2">
                    {% csrf_token %}
                    <textarea name="remark" class="form-control mb-2" rows="2"
                        placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    <button type="submit" class="btn btn-success">
                        ‚úÖ Approve
                    </button>
                </form>
                {% endif %}

                {# ---------- ADMIN ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô ---------- #}
                {% if is_admin and ticket.status_id != 4 and ticket.status_id != 5 %}
                <form method="post" action="{% url 'approve_ticket' ticket.id %}" class="mb-2">
                    {% csrf_token %}
                    <input type="hidden" name="admin_override" value="1">
                    <button type="submit" class="btn btn-danger">
                        üöÄ Admin ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
                    </button>
                </form>
                {% endif %}

                {# ---------- ADMIN ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏á‡∏≤‡∏ô ---------- #}
                {% if is_admin and ticket.status_id == 8 %}
                <div class="card shadow-sm border-primary mb-4">
                    <div class="card-body text-center">

                        <div class="fw-semibold text-primary mb-2">
                            üõ† ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
                        </div>

                        <form method="post" action="{% url 'admin_complete_ticket' ticket.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary btn-lg">
                                ‚úÖ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                            </button>
                        </form>

                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {%endblock %}