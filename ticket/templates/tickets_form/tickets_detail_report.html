{% extends "base.html" %}
{% load tz %}

{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô{% endblock %}

{% block content %}
<main class="main-content">

    <div class="dashboard-card">

        <h3 class="fw-bold mb-3">
            {{ ticket.title }}
        </h3>

        <p class="text-muted mb-4">
            ‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏î‡∏¢ {{ ticket.user_name }}
            {% if ticket.department %}
            | ‡πÅ‡∏ú‡∏ô‡∏Å {{ ticket.department }}
            {% endif %}
            <br>
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {{ ticket.create_at|localtime|date:"d M Y H:i" }} ‡∏ô.
        </p>

        <hr>

        <!-- DESCRIPTION -->
        <div class="mb-4">
            <h6 class="fw-semibold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠</h6>
            <p>{{ ticket.description|linebreaksbr }}</p>
        </div>

        <!-- OLD / NEW VALUE -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header fw-semibold">
                        ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (Old Value)
                    </div>
                    <div class="card-body">
                        <pre class="mb-0">{{ detail.old_value }}</pre>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header fw-semibold">
                        ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (New Value)
                    </div>
                    <div class="card-body">
                        <pre class="mb-0">{{ detail.new_value }}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= APPROVE SECTION ================= -->
        {% if can_approve %}
        <div class="card shadow-sm border-success mb-4">
            <div class="card-body">

                <div class="fw-semibold text-success mb-2">
                    ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Level {{ my_level }})
                </div>

                <form method="post" action="{% url 'approve_ticket' ticket.id %}">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <textarea name="remark" class="form-control" rows="2"></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">
                        ‚úÖ Approve
                    </button>
                </form>

            </div>
        </div>
        {% endif %}
        {% if can_approve or is_admin %}
        <div class="card shadow-sm border-success mb-4">
            <div class="card-body">

                {% if is_admin %}
                <div class="fw-semibold text-danger mb-2">
                    ‚ö† Admin Override Approval
                </div>
                {% else %}
                <div class="fw-semibold text-success mb-2">
                    ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Level {{ my_level }})
                </div>
                {% endif %}

                <form method="post" action="{% url 'approve_ticket' ticket.id %}">
                    {% csrf_token %}

                    <div class="mb-3">
                        <textarea name="remark" class="form-control" rows="2" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>

                    {% if is_admin %}
                    <input type="hidden" name="admin_override" value="1">
                    {% endif %}

                    <button type="submit" class="btn {% if is_admin %}btn-danger{% else %}btn-success{% endif %}">
                        {% if is_admin %}
                        üöÄ Admin Approve
                        {% else %}
                        ‚úÖ Approve
                        {% endif %}
                    </button>
                </form>

            </div>
        </div>
        {% endif %}
        <!-- BACK -->
        <div class="mt-4">
            <a href="{% url 'tickets_list' %}" class="btn btn-secondary">
                ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </a>
        </div>

    </div>

</main>
{% endblock %}